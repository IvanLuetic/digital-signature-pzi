import{r as n,c as a,o as s,a as e,b as T,w as $,v as G,d as K,F as C,e as O,f as P,t as U,g as A,h as b,i as D,n as E,j as L,_ as W,k as H}from"./index-_KYfJ8Fu.js";import{s as J,g as q,d as Q}from"./document-DAwv_s8A.js";import{G as X,g as Y}from"./pdf-DjQuioL1.js";const Z={class:"fixed inset-0 bg-black/70 flex items-center justify-center z-100 backdrop-blur-sm p-4 pt-10 sm:pt-0"},ee={class:"bg-white rounded-xl shadow-2xl w-full max-w-md mx-4 transform transition-all duration-300"},te={class:"p-6 space-y-5"},oe=["value"],le={class:"bg-gray-50 rounded-b-xl px-6 pb-4 flex gap-3 justify-end"},se=["disabled"],re={__name:"SignDocForm",props:{keys:{type:Array}},emits:["close","sign"],setup(y,{emit:v}){const p=v,d=n(""),o=n(null),m=()=>{p("sign",{password:d.value,public_key_id:o.value})};return(u,l)=>(s(),a("div",Z,[e("div",ee,[l[8]||(l[8]=e("div",{class:"bg-gradient-to-r from-blue-600 to-blue-700 text-white px-6 py-3 rounded-t-xl"},[e("h2",{class:"text-xl font-semibold flex items-center gap-2"},"Sign Document"),e("p",{class:"text-blue-100 text-sm mt-1"}," Enter your credentials to digitally sign this document ")],-1)),e("div",te,[e("div",null,[l[3]||(l[3]=e("label",{for:"password",class:"block text-sm font-medium text-gray-700 mb-2"}," Password ",-1)),$(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>d.value=i),id:"password",type:"password",placeholder:"Enter your password",class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 outline-none transition"},null,512),[[G,d.value]])]),e("div",null,[l[5]||(l[5]=e("label",{for:"keySelection",class:"block text-sm font-medium text-gray-700 mb-2"}," Select Signing Key ",-1)),$(e("select",{id:"keySelection","onUpdate:modelValue":l[1]||(l[1]=i=>o.value=i),class:"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-1 focus:ring-blue-500 focus:border-blue-500 outline-none transition"},[l[4]||(l[4]=e("option",{value:"",disabled:""},"Choose a signing key",-1)),(s(!0),a(C,null,O(y.keys,i=>(s(),a("option",{key:i.id,value:i.id},U(`Key ${i.id}`),9,oe))),128))],512),[[K,o.value]])]),l[6]||(l[6]=T('<div class="bg-blue-50 border border-blue-200 rounded-lg px-4 py-3"><div class="flex flex-col gap-3"><div class="flex flex-row gap-2 items-center"><svg class="w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg><h4 class="font-medium text-blue-800">Security Notice</h4></div><span class="text-md text-blue-700 -mt-2"> This document will be signed with your private PGP key. Any modifications to the document will invalidate the signature. </span></div></div>',1))]),e("div",le,[e("button",{onClick:l[2]||(l[2]=i=>u.$emit("close")),class:"px-4 text-gray-700 cursor-pointer border border-gray-300 rounded-lg hover:bg-gray-100 transition-colors font-medium"}," Cancel "),e("button",{onClick:m,disabled:!d.value||!o.value,class:"px-4 py-2 bg-blue-600 cursor-pointer text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors font-medium flex items-center gap-2"},l[7]||(l[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1),P(" Sign Document ",-1)]),8,se)])])]))}},ne={class:"flex flex-col items-center gap-8 mx-4 pb-30"},ae={class:"w-full md:w-3/5 lg:w-2/5 flex justify-center items-center"},ie={key:0,class:"flex justify-center items-center z-50 absolute inset-0 bg-white/80 backdrop-blur-sm rounded-2xl"},ue={key:1,class:"mdi mdi-cloud-upload text-7xl text-blue-600"},de={key:2,class:"text-xl text-gray-600 text-center font-medium"},ce=["src"],pe={class:"z-50"},me={class:"relative bottom-6 text-center"},ge={key:0},ve={key:0,class:"flex items-center justify-center"},be={key:1,class:"flex items-center justify-center"},fe={__name:"SignDocument",emits:["message"],setup(y,{emit:v}){X.workerSrc="../../node_modules/pdfjs-dist/build/pdf.worker.mjs";const p=v,d=n(!1),o=n(null),m=n(!1),u=n(!1),l=n([]),i=n(!1),x=n(""),B=async()=>{if(o.value){const r=await q();l.value=r.data.keys,i.value=!0}else alert("Please upload a file to sign")},f=n(null),w=n(null),S=n(null),h=n(null),j=r=>{if(o.value=r.dataTransfer?.files[0]||r.target.files[0],console.log(o.value),d.value=!0,o.value&&(o.value.type.endsWith("png")||o.value.type.endsWith("jpeg")||o.value.type==="application/pdf")){if(o.value.type.startsWith("image/")){const t=new FileReader;t.onload=()=>{const c=t.result;f.value=c,h.value.style.display="none"},t.readAsDataURL(o.value)}else o.value.type==="application/pdf"?(z(o.value),f.value=null):S.value.style.backgroundImage="";d.value=!1}else d.value=!1,alert("Allowed file types are .png, .jpg and .pdf"),o.value=null},z=async r=>{const t=new FileReader;t.onload=async c=>{try{const g=c.target.result,F=await(await Y(g).promise).getPage(1),k=F.getViewport({scale:1}),_=h.value,M=_.getContext("2d");_.width=k.width,_.height=k.height,await F.render({canvasContext:M,viewport:k}).promise}catch(g){console.error("Error rendering PDF:",g)}},t.readAsArrayBuffer(r)},N=()=>{w.value.click()},R=async r=>{if(o.value){u.value=!0;try{const t=new FormData;t.append("file",o.value),t.append("public_key_id",r.public_key_id),t.append("password",r.password);const c=await J(t);x.value=c.data.id,p("message",{type:"success",message:"Document signed succesfuly!"}),m.value=!0}catch(t){console.error("Error signing document",t),p("message",{type:"error",message:"Error signing document"})}finally{u.value=!1,i.value=!1}}else alert("Please upload a document to sign")},V=async()=>{try{const r=await Q(x.value),t=new Blob([r.data],{type:"application/zip"}),c=window.URL.createObjectURL(t),g=document.createElement("a");g.href=c,g.download="document.zip",document.body.appendChild(g),g.click(),setTimeout(()=>{document.body.removeChild(g),window.URL.revokeObjectURL(c)},100)}catch(r){throw console.error("Download failed:",r),p("message",{type:"error",message:r.response?.data?.message||"Error downloading document"}),r}},I=()=>{o.value=null,f.value=null,m.value=!1,u.value=!1,w.value.value=null,x.value=null};return(r,t)=>(s(),a(C,null,[i.value?(s(),A(re,{key:0,onClose:t[0]||(t[0]=c=>i.value=!1),onSign:t[1]||(t[1]=c=>R(c)),keys:l.value},null,8,["keys"])):b("",!0),t[7]||(t[7]=e("div",{class:"py-6 px-0 text-center"},[e("h1",{class:"font-bold mb-2 mx-auto"},"Upload document to sign"),e("h4",{class:"text-gray-800 max-w-160 mx-auto"}," Click below to upload your document or drag and drop it here. Accepted file formats: PDF, JPG, PNG ")],-1)),e("div",ne,[e("div",ae,[e("div",{ref_key:"uploadArea",ref:S,class:E(["flex flex-col justify-around items-center min-h-[40vh] w-full relative bg-gradient-to-br from-gray-100 to-gray-50 rounded-2xl border-2 border-dashed border-gray-300 hover:border-blue-200 hover:bg-gradient-to-br hover:from-blue-50 hover:to-gray-50 transition-all duration-300 shadow-lg hover:shadow-xl",{"animate-pulse scale-[1.02] border-blue-500":d.value}]),onDragover:t[2]||(t[2]=D(()=>{},["prevent"])),onDragenter:t[3]||(t[3]=D(()=>{},["prevent"])),onDrop:D(j,["prevent"])},[u.value?(s(),a("div",ie,t[4]||(t[4]=[e("div",{class:"text-center space-y-4 p-8"},[e("div",{class:"w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mx-auto"}),e("p",{class:"font-semibold text-gray-700 text-lg"},"Signing your document...")],-1)]))):b("",!0),o.value?b("",!0):(s(),a("i",ue)),o.value?b("",!0):(s(),a("div",de,t[5]||(t[5]=[e("span",{class:"text-blue-600"},"Drag & Drop",-1),e("br",null,null,-1),e("span",{class:"text-gray-400 text-lg"},"OR",-1),e("br",null,null,-1)]))),f.value?(s(),a("img",{key:3,src:f.value,alt:"Uploaded Document",class:E([u.value?"blur-sm w-full absolute h-full object-cover rounded-2xl":"blur-xs w-full absolute h-full object-cover rounded-2xl"])},null,10,ce)):b("",!0),o.value&&!f.value?(s(),a("canvas",{key:4,ref_key:"pdfCanvas",ref:h,class:"min-h-[40vh] w-full absolute h-full rounded-2xl",style:{filter:"blur(1px)"}},null,512)):b("",!0),e("input",{type:"file",ref_key:"fileInput",ref:w,class:"hidden",accept:".jpg, .png, .pdf",onChange:j},null,544),e("div",pe,[o.value?(s(),a("button",{key:1,class:"bg-white hover:bg-gray-100 text-gray-700 py-3 px-8 rounded-xl text-lg font-semibold border-2 border-gray-400 hover:border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",onClick:I}," CANCEL ")):(s(),a("button",{key:0,class:"bg-white hover:bg-gray-10 text-gray-700 py-3 px-8 rounded-xl text-lg font-semibold border-2 border-gray-300 shadow-md hover:shadow-lg transition-all duration-200 cursor-pointer",onClick:N}," SELECT FILE "))])],34)]),e("div",me,[o.value?(s(),a("p",ge,U(o.value.name)+" selected",1)):b("",!0)]),m.value?(s(),a("div",be,[e("button",{onClick:V,class:"bg-gradient-to-r absolute from-blue-500 to-blue-600 text-white hover:from-blue-700 hover:to-blue-800 text-2xl font-semibold py-6 px-7 rounded-full border-1 border-black shadow-xl hover:shadow-xl transform hover:scale-105 transition-all duration-300 cursor-pointer"},t[6]||(t[6]=[P(" Download ",-1),e("i",{class:"mdi mdi-download text-2xl mt-1"},null,-1)]))])):(s(),a("div",ve,[e("button",{onClick:B,class:"bg-gradient-to-r absolute from-blue-500 to-blue-600 text-white hover:from-blue-700 hover:to-blue-800 w-50 text-2xl font-semibold py-6 rounded-full border-1 border-black shadow-xl hover:shadow-xl transform hover:scale-105 transition-all duration-300 cursor-pointer"}," Sign document ")]))])],64))}},ke={__name:"SignDocument",setup(y){const v=n(""),p=n(""),d=m=>{m.type=="error"?v.value=m.message:p.value=m.message},o=()=>{v.value="",p.value=""};return(m,u)=>(s(),a(C,null,[L(W),v.value||p.value?(s(),A(H,{key:0,error:v.value,success:p.value,onClose:u[0]||(u[0]=l=>o()),class:"mx-auto"},null,8,["error","success"])):b("",!0),L(fe,{onMessage:u[1]||(u[1]=l=>d(l))})],64))}};export{ke as default};
